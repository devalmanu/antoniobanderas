"use strict";const mainIndexPage=document.querySelector(".main-index");document.querySelectorAll('a.link-button[href^="#"').forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();let t=this.getAttribute("href").substring(1);const o=document.getElementById(t).getBoundingClientRect().top;window.scrollBy({top:o,behavior:"smooth"})}))}));const animItems=document.querySelectorAll("._anim-items");if(animItems.length>0){function e(){for(let e=0;e<animItems.length;e++){const o=animItems[e],r=o.offsetHeight,n=t(o).top,i=10;let s=window.innerHeight-r/i;r>window.innerHeight&&(s=window.innerHeight-window.innerHeight/i),pageYOffset>n-s&&pageYOffset<n+r?o.classList.add("_active"):o.classList.contains("_anim-no-hide")||o.classList.remove("_active")}}function t(e){const t=e.getBoundingClientRect(),o=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+r,left:t.left+o}}window.addEventListener("scroll",e),setTimeout((()=>{e()}),300)}const offerSection=document.querySelector("#offer"),waterSection=document.querySelector("#water"),sideBar=document.querySelector(".steps__sidebar");let elementSteps=document.querySelector("#steps"),elementSurprise=document.querySelector("#surprise"),elementСreator=document.querySelector("#creator"),elementFriends=document.querySelector("#friends"),allElementsSection=[elementSteps,elementSurprise,elementСreator,elementFriends];function changeSideBarTitle(){allElementsSection.forEach(((e,t)=>{if(isVisible(e)){let t=e.querySelector("h4.section-title").innerText;sideBar.querySelector("h4").innerText=t}}))}function changeSideBarLink(){allElementsSection.forEach(((e,t)=>{if(isVisible(e)){let t=e.nextElementSibling,o=e.closest(".pin-spacer");if(t&&sideBar.querySelector(".link-button").setAttribute("href",`#${e.nextElementSibling.id}`),"null"==t&&o){let e=o.querySelector(".blockIn").getAttribute("id");sideBar.querySelector(".link-button").setAttribute("href",`#${e}`)}}}))}function sidebarFixed(){if(mainIndexPage){const e=offerSection.offsetHeight;window.pageYOffset>e?(sideBar.classList.add("bar-fixed"),changeSideBarTitle(),window.innerWidth<1200&&changeSideBarLink()):sideBar.classList.remove("bar-fixed")}}function visibleDiv(e){let t=window.pageYOffset+e.getBoundingClientRect().top,o=window.pageYOffset+e.getBoundingClientRect().bottom,r=window.pageYOffset,n=(window.pageXOffset,window.pageXOffset,document.documentElement.clientWidth,window.pageYOffset+document.documentElement.clientHeight);if(o>r&&t<n){let t=e.querySelector("h4.section-title").innerText;sideBar.querySelector("h4").innerText=t,sideBar.querySelector(".link-button").setAttribute("href",`#${e.nextElementSibling.id}`)}}function isVisible(e){if(mainIndexPage){const t=0,o={top:window.pageYOffset,bottom:window.pageYOffset+document.documentElement.clientHeight},r={top:window.pageYOffset+t+e.getBoundingClientRect().top,bottom:window.pageYOffset+e.getBoundingClientRect().bottom};return r.bottom>=o.top&&r.top<=o.bottom}}function toggleVisibilityClass(e){isVisible(e)?e.classList.add("visible"):e.classList.remove("visible")}function startAnimate(){if(mainIndexPage){const e=document.querySelector("#steps");gsap.registerPlugin(ScrollTrigger);let t=gsap.timeline();ScrollTrigger.create({animation:t,trigger:".page_body",start:"top top",end:"+=500",paused:!0,scrub:!0}),t.to("#offer",{ease:"power1.out",duration:2}),t.to("#offer-content",{scrollTrigger:{trigger:".offer",start:"top 0%",end:"bottom 0%",scrub:2},top:"auto",ease:"linear",scale:.65,position:"fixed",opacity:0,stagger:.3}),t.to("#offer__arrow",{scrollTrigger:{trigger:".offer",start:"top 0%",end:"bottom 50%",scrub:5},opacity:0});let o=gsap.timeline();ScrollTrigger.create({animation:o,trigger:".steps",start:"top top",end:"bottom",scrub:!0,pin:!0,onEnter:function(){document.querySelector("#water .link-button").setAttribute("href","#surprise")},onLeave:function(){e.classList.add("leave")},onEnterBack:function(){e.classList.remove("leave")}}),o.fromTo(".steps__number-ball",{opacity:0,scale:0},{opacity:1,scale:1,duration:.1,ease:"power2.out"},0),o.fromTo(".finish-line",{opacity:0},{opacity:1,duration:.1,ease:"power2.out"},"<25%"),o.to(".steps__number-ball",{opacity:0,scale:0,duration:.1,ease:"power2.out"},.1),o.to(".finish-line",{opacity:0,duration:.1,ease:"power2.out"},.1);let r=gsap.timeline();ScrollTrigger.create({animation:r,trigger:elementSurprise,start:"top top",end:"bottom",scrub:!0,onEnter:function(){document.querySelector("#water .link-button").setAttribute("href","#creator")}}),r.fromTo(".surprise__one .surprise__img",{scrollTrigger:{trigger:".surprise__slide-1",start:"top bottom",scrub:3},x:"90vw",scale:2,opacity:1,duration:.5},{scrollTrigger:{trigger:".surprise__slide-1",start:"top center",scrub:2},scale:.7,opacity:1,duration:.3,delay:.5,x:"-50vw"},">"),r.fromTo(".surprise__two .surprise__img",{scrollTrigger:{trigger:".surprise__slide-2",start:"top bottom",scrub:3},x:"-100vw",scale:1.5,opacity:1,duration:.5},{scrollTrigger:{trigger:".surprise__slide-2",start:"top center",scrub:2},scale:.5,opacity:1,duration:.3,delay:.5,x:"100vw"},">"),r.fromTo("#surprise__maintext",{scrollTrigger:{trigger:".surprise__slide-3",scrub:3},y:"-20vh",scale:.8,opacity:0,duration:2.5,ease:"power1.out"},{scrollTrigger:{trigger:".surprise__slide-3",scrub:1},scale:1,opacity:1,duration:2.5,ease:"power1.out",y:"0"},">"),r.fromTo(".surprise__slide-3 img",{scrollTrigger:{trigger:".surprise__slide-3",scrub:3},scale:.8,opacity:1,duration:2.5,ease:"power1.out"},{scrollTrigger:{trigger:".surprise__slide-3",scrub:1},scale:1.2,opacity:1,delay:.5,duration:2.5,ease:"power1.out"},">");let n=gsap.timeline();ScrollTrigger.create({animation:n,trigger:elementСreator,start:"top top",end:"top center",scrub:!0,pin:!0,onEnter:function(){document.querySelector("#water .link-button").setAttribute("href","#friends")}}),n.fromTo(".creator__content",{scrollTrigger:{trigger:elementСreator,start:"top bottom",scrub:3},scale:1.8,ease:"power1.out",duration:.3},{scrollTrigger:{trigger:elementСreator,start:"top center",scrub:2},ease:"power1.out",scale:0,position:"sticky",opacity:.5,stagger:.3},1);let i=gsap.timeline();i.to(elementFriends,{ease:"power1.out",duration:1,onEnter:function(){document.querySelector("#water .link-button").setAttribute("href","#eau-water")}}),ScrollTrigger.create({animation:i,trigger:elementFriends,start:"top top",end:"bottom",scrub:!0,pin:!0}),i.fromTo(".card-2",{scrollTrigger:{trigger:".friends__content",start:"top",scrub:5},top:"-15vw",right:"-60%",scale:1.4,delay:.5,opacity:1,duration:1.5,ease:"none"},{scale:1,opacity:0,top:"50%",right:"50%",xPercent:-50,yPercent:-50,duration:4,ease:"none"},.5),i.fromTo(".card-1",{scrollTrigger:{trigger:elementFriends,scrub:10},top:"50vw",left:"-25vw",opacity:1,delay:.5,scale:2,duration:1.5,ease:"none"},{scale:.8,opacity:0,top:"50%",left:"50%",xPercent:-50,yPercent:-50,duration:5,ease:"none"},1.5),i.fromTo(".card-4",{scrollTrigger:{trigger:elementFriends,scrub:15},top:"40vw",right:"-50%",scale:3,delay:.5,opacity:1,duration:1.5,ease:"none"},{scale:1,opacity:0,top:"50%",right:"50%",xPercent:-50,yPercent:-50,duration:5,ease:"none"},3),i.fromTo(".card-3",{scrollTrigger:{trigger:elementFriends,scrub:19},top:"25vw",left:"-40vw",scale:2.5,delay:.5,opacity:1,duration:1.5,ease:"none"},{scale:1,opacity:0,top:"50%",left:"50%",xPercent:-50,yPercent:-50,duration:5,ease:"none"},4.5),i.to(".friends__content",{scrollTrigger:{trigger:elementFriends,scrub:20},duration:1.5,ease:"none"},">")}}function stepsAppearance(){const e=document.querySelector("#steps"),t=document.documentElement.clientHeight,o=e.getBoundingClientRect().top+0,r=[e.querySelector("#step-one"),e.querySelector("#step-two"),e.querySelector("#steps__eua-blue"),e.querySelector("#steps__eua-dark"),e.querySelector("#step-three"),e.querySelector("#step-four")],n=e.classList.contains("leave"),i=n?0:1,s=[{top:-200,left:-50,zoom:2,opacity:i},{top:-150,left:70,zoom:2,opacity:i},{top:-50,left:100,zoom:3,opacity:i},{top:-10,left:-50,zoom:3,opacity:i},{top:0,left:-50,zoom:2,opacity:i},{top:0,left:70,zoom:2,opacity:i}];if(setStepsStyles(r,s),e.classList.contains("visible")){const e=(t-o)/t;let i=[];s.forEach((t=>{i.push({top:(1-e)*t.top,left:(1-e)*t.left,zoom:n?5*(1.2-e):t.zoom-e*(t.zoom-1),opacity:n?5*(1.2-e):1})})),setStepsStyles(r,i)}}function setStepsStyles(e,t){e.forEach(((e,o)=>{e.style.transform=`translate(${t[o].left}vw, ${t[o].top}vh) scale(${t[o].zoom})`,e.style.opacity=t[o].opacity}))}window.addEventListener("scroll",(function(){mainIndexPage&&(sidebarFixed(),window.innerWidth>=1200&&(toggleVisibilityClass(document.querySelector("#steps")),stepsAppearance()))})),window.addEventListener("load",(function(){mainIndexPage&&window.innerWidth>=1200&&(startAnimate(),toggleVisibilityClass(document.querySelector("#steps")),stepsAppearance())})),window.addEventListener("resize",(function(){})),gsap.registerPlugin(ScrollTrigger);const formCover=document.querySelector(".form-cover");if(formCover){const o=document.querySelector("#imageUpload"),r=document.querySelector(".imagePreview");function n(){const e=o.files[0];if(e&&/\.(jpe?g|png)$/i.test(e.name)){const t=new FileReader;t.addEventListener("load",(function(){const e=new Image;e.src=t.result;let o='url("'+e.src+'")';e.onload=function(){let t=formCover.querySelector(".message-error");if(t.style.display="none",e.width>=600)return r.style.backgroundImage=o,!0;t.style.display="block",t.textContent="Фото меньше допустимого размера"}}),!1),t.readAsDataURL(e)}}o.addEventListener("change",n);const i=document.querySelector(".avatar-description__text"),s=document.querySelector(".counter-text__current"),c=document.querySelector(".avatar-title-finish"),a=document.querySelector(".avatar-desc-finish");(()=>{const e=document.querySelector(".select-default");new Choices(e,{searchEnabled:!1});let t=e.getAttribute("aria-label");e.closest(".choices").setAttribute("aria-label",t),e.addEventListener("change",(function(e){c.textContent=e.detail.value}))})();function l(e){const t=e.target.value.length;s.textContent=t,a.textContent=e.target.value}document.querySelector(".color-select").addEventListener("click",(e=>{if(e.target.classList.contains("color-select__btn")){e.preventDefault(),document.querySelectorAll(".color-select__btn").forEach((e=>e.classList.remove("color-select__btn--active")));e.target.dataset.color;let t=e.target.style.backgroundColor;e.target.classList.add("color-select__btn--active"),a.style.color=t,c.style.color=t}})),i.addEventListener("input",l);const u=document.querySelector(".avatar-cover"),d=document.querySelector(".interactive__cover"),g=document.querySelector(".button-generate"),p=document.querySelector(".interactive__result"),m=document.querySelector(".cover-counter__current"),f=document.querySelector(".cover__arrow a"),y=document.querySelector(".btn-back-link");let b=1;g.addEventListener("click",(()=>{let e=r.cloneNode(!0);u.appendChild(e),formCover.classList.add("is-vishidden"),p.classList.remove("is-vishidden"),m.textContent=b+1,f.href=document.location.pathname,y.href=document.location.pathname,html2canvas(d).then((e=>{e.toBlob((e=>{let t=new FormData;t.append("file_keeper[file]",e,"Antonio-Banderas.jpeg"),fetch("https://icon-promo.ru/api/file_keepers",{body:t,method:"POST"}).then((e=>e.json())).then((e=>{console.log(e.data.attributes.static_url),document.getElementById("log").innerText=e.data.attributes.static_url}))}),"image/jpeg",.95)}))})),p.classList.contains("is-vishidden")||f.addEventListener("click",(()=>{p.classList.add("is-vishidden"),formCover.classList.remove("is-vishidden"),m.textContent=b-1}));document.querySelector(".button-save").addEventListener("click",(()=>{html2canvas(d).then((e=>{const t=document.createElement("a");let o=e.toDataURL("image/jpeg",1);t.href=o,t.download="Antonio-Banderas.jpeg",t.click()}))}));const w=new ClipboardJS(".btn-clipboard",{text:function(e){return document.getElementById("log").innerText}});w.on("success",(function(e){e.trigger.textContent="Скопировано",window.setTimeout((function(){e.trigger.textContent="Cкопировать ссылку"}),3e3)})),w.on("error",(function(e){}))}